<?php

namespace Touchwire\Entity\Repository;

use Doctrine\ORM\EntityRepository, Touchwire\Entity\User;

/**
 * UserRepo
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class UserRepo extends EntityRepository
{
	public function saveUser(User $u, $values) {
		$em = $this->getEntityManager();
		
		//form values
		foreach($values as $field => $key){
			if($key != null){
				switch ($field){
					case 'username': $u->setUsername($key);
						break;
					case 'pswd': $u->setPassword(md5($key));	break;
					case 'active': $u->setActive($key); break;
					case 'role': $u->setRole($key); break;
				}
			}
		}
		//mdofy if values not null
		if($values != null){
			$u->setUpdatedAt(new \DateTime('now'));
		}
		$em->persist($u);
		//
		//$this->getUserByUsername($values['username']);
	}
	
		public function removeUser($id) {
		$em = $this->getEntityManager();
		$proxy = $em->getReference('Touchwire\Entity\User', $id);
		$em->remove($proxy);
		}
	
		public function getUserByUsername($username){
		$em = $this->getEntityManager();
		$q = $em->getRepository('Touchwire\Entity\User')
				  ->findBy(array('username' => $username));
	
	
				return $q[0]->getId();
		}
}